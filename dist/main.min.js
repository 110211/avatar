"use strict";var express=require("express"),bodyParser=require("body-parser"),db=require("./lib/mongo"),jwt=require("./lib/jwt"),app=express(),port=process.env.PORT||3e3;process.env.TZ="Asia/Ho_Chi_Minh",app.use(bodyParser.urlencoded({extended:!0})),app.use(express.urlencoded({extended:!0})),app.use(express.json({extended:!0})),app.use(express.static(__dirname)),app.get("/",function(e,n){n.sendFile("./index.html",{root:__dirname})}),app.get("/login",function(e,n){n.sendFile("./login.html",{root:__dirname})}),app.get("/me",function(e,n){n.setHeader("content-type","application/json; charset=utf-8");var s=e.header("authorization"),t=jwt.getTokenFromHeader(s),r=jwt.verifyJWTToken(t);r?n.send(JSON.stringify({message:"Kiểm tra thông tin thành công",user:r.user,success:!0})):n.send(JSON.stringify({message:"Token không hợp lệ hoặc đã hết hạn",success:!1}))}),app.get("/admin",function(e,n){n.sendFile("./adpanel.html",{root:__dirname})}),app.post("/api/login",function(n,s){var t,r,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.body.user,r=n.body.password,e.next=4,regeneratorRuntime.awrap(db.findData("plantszombie","users",{user:t,password:r}));case 4:o=e.sent,s.setHeader("content-type","application/json; charset=utf-8"),0<o.length?s.send(JSON.stringify({success:!0,token:jwt.createJWTToken({user:t}),right:o[0].right,message:"Login thành công"})):s.send(JSON.stringify({success:!1,message:"Sai tài khoản hoặc mật khẩu"}));case 7:case"end":return e.stop()}})}),app.listen(port,function(){console.log("server is running on port 3000")});
//# sourceMappingURL=main.min.js.map
